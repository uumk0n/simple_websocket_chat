# WebSocket Чат с Redis и Tornado

Этот проект реализует чат с использованием WebSocket, Redis и Tornado. Сервер подписывается на каналы Redis для получения сообщений, которые затем рассылаются всем подключенным клиентам в соответствующие комнаты чата. Для предотвращения дублирования сообщений, реализована проверка на уникальность идентификаторов сообщений.

## Требования

Перед запуском убедитесь, что у вас установлены следующие зависимости:

- Python 3.x
- Redis
- Установите зависимости с помощью pip:

  ```bash
  pip install -r requirements.txt
  ```

## Запуск

1. Склонируйте репозиторий:

   ```bash
   git clone https://github.com/uumk0n/simple_websocket_chat.git
   cd simple_websocket_chat
   ```

2. Создайте файл `.env` в корне проекта и добавьте в него следующие переменные:

   ```env
   REDIS_HOST=localhost
   REDIS_PORT=6379
   CHANNEL_NAME=chat
   WEBSOCKET_PORT=8888
   ```

   При необходимости замените значения на свои.

3. Запустите Redis в docker

   ```bash
   docker-compose up
   ```

4. Запустите сервер:

   ```bash
   python main.py
   ```

5. Откройте браузер и перейдите по адресу:

   ```
   http://localhost:8888
   ```

## Структура проекта

- `main.py`: Главный файл приложения, который запускает сервер и управляет WebSocket соединениями.
- `.env`: Файл с конфигурационными переменными окружения (путь к Redis, порт WebSocket, и т.д.).
- `static/index.html`: Простая HTML страница для клиента, подключающегося к WebSocket серверу.

## Как это работает

1. **WebSocket сервер**:

   - Когда клиент подключается, он попадает в определенную комнату чата, которая указывается в URL (например, `/ws/chatroom1`).
   - После подключения, клиент получает приветственное сообщение и список пользователей в комнате.

2. **Redis**:

   - Сервер подписывается на Redis канал, соответствующий выбранной комнате чата.
   - Когда другое сообщение публикуется на этот канал, сервер рассылает его всем подключенным клиентам в этой комнате.

3. **Обработка дубликатов сообщений**:

   - Каждое сообщение имеет уникальный идентификатор. Если сообщение с таким же идентификатором уже было обработано, оно не будет передано клиентам.

4. **Подключение и отключение клиентов**:
   - Когда клиент подключается, его добавляют в список пользователей комнаты, и все клиенты получают обновленную информацию о текущих подключенных пользователях.
   - При отключении клиента, он удаляется из списка пользователей этой комнаты.

## Эндпоинты

- **WebSocket подключение**:

  - Путь: `/ws/<room_id>`
  - Для подключения к определенной комнате чата используйте WebSocket. Вместо `<room_id>` подставьте имя или ID комнаты, в которую хотите войти.

- **HTTP (MainHandler)**:
  - Путь: `/`
  - Отображает статическую HTML страницу для клиента, который подключается через WebSocket.

## Примечания

- Для работы сервера требуется работающий экземпляр Redis.
- Данный сервер не поддерживает аутентификацию или шифрование WebSocket соединений. Для продакшн-окружений рекомендуется добавить соответствующую защиту.
